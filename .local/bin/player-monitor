#!/bin/bash
# ~/.local/bin/player-monitor

pid=$(pgrep -n dwmblocks)
[ -z "$pid" ] && exit 1  # dwmblocks не найден — выходим

handler() {
  pkill -RTMIN+2 dwmblocks || kill -RTMIN+2 "$pid"
}

# слушаем оба потока параллельно
stdbuf -oL playerctl -p mpd metadata --follow 2>/dev/null | while read -r _; do handler; done &
stdbuf -oL playerctl -p mpd status --follow 2>/dev/null | while read -r _; do handler; done &

wait
